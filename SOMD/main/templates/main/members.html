{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/members.css' %}">

<section class="header">
    <a class="logo" href="{% url 'main:mainpage' %}">SOMD</a>
</section>
<section class="EmptyForHeader"></section>
<section class="somdPage">
    <section class="mainTitle">
        <i class="fas fa-portrait"></i>
        관리하기
    </section>
    <section class="mainForm">
        <div>
            <section class="titlebtn">
              <a class="button">신규회원관리</a>
            </section>
            <section class="newMemberForm">
              <p class="newMemberName">노진구</p>
              <div class="clickSpan newMemberFormTitle">가입신청서 제목1</div>
            </section>
            <section class="newMemberForm">
              <p class="newMemberName">도라에몽</p>
              <div class="clickSpan newMemberFormTitle">가입신청서 제목2</div>
            </section>
          
            <div id="popup" class="popup">
                <p>NEW JOIN REQUEST!</p>
                <div class="popupjoinform">
                    <p class="popupName" style="color:black; font-size: 15px; font-weight: bold; margin:0"></p>
                    <p class="popupTitle" style="color:gray; font-size: 10px; font-weight: 500; margin:0"></p>
                </div>
                <div class="popupBtns">
                    <button id="closeBtn" class="popupBtn">승인</button>
                    <button id="closeBtn" class="popupBtn">거부</button>
                </div>
            </div>
        </div>
        <div>
            <section class="titlebtn">
              <a class="button">회원관리</a>
            </section>
            <section id="drag-drop-section1">
              <section class="existingMember draggable" draggable="true" ondragstart="drag(event)">
                <i class="fas fa-sort"></i>
                <div class="manageMemberForm">
                  <div class="existingMemberInfo">
                    <span class="existingMemberName">홍길동</span>
                    <span class="existingMemberCol">사회과학대학 사회학과</span>
                  </div>
                  <button class="deleteBtn">삭제</button>
                </div>
              </section>
            </section>
          
            <section id="drag-drop-section2">
              <section class="existingMember draggable" draggable="true" ondragstart="drag(event)">
                <i class="fas fa-sort"></i>
                <div class="manageMemberForm">
                  <div class="existingMemberInfo">
                    <span class="existingMemberName">손오공</span>
                    <span class="existingMemberCol">경영대학 경영학과</span>
                  </div>
                  <button class="deleteBtn">삭제</button>
                </div>
              </section>
            </section>
          </div>
    </section>
</section>

<script>
    //Drag and drop Test 1 #20230622 15:00
    // function allowDrop(event) {
    //   event.preventDefault();
    // }

    // function drag(event) {
    //   event.dataTransfer.setData("text/plain", event.target.id);
    // }

    // function drop(event) {
    //   event.preventDefault();
    //   var data = event.dataTransfer.getData("text/plain");
    //   var draggableElement = document.getElementById(data);
    //   var dropzone = event.target;

    //   // 드롭된 위치에 섹션을 삽입
    //   dropzone.parentNode.insertBefore(draggableElement, dropzone);
    // }

    //     var draggables = document.getElementsByClassName("draggable");
    // var selectedElement = null;
    // var offset = { x: 0, y: 0 };

    // // 드래그 시작 시 호출되는 함수
    // function dragStart(event) {
    //   selectedElement = event.target;
    //   offset.x = event.clientX - selectedElement.offsetLeft;
    //   offset.y = event.clientY - selectedElement.offsetTop;
    // }

    // // 드래그 중에 호출되는 함수
    // function drag(event) {
    //   event.preventDefault();
    //   if (selectedElement) {
    //     selectedElement.style.left = (event.clientX - offset.x) + "px";
    //     selectedElement.style.top = (event.clientY - offset.y) + "px";
    //   }
    // }

    // // 드래그 종료 시 호출되는 함수
    // function dragEnd() {
    //   selectedElement = null;
    // }

    // // 각각의 draggable 요소에 이벤트 리스너를 추가합니다.
    // for (var i = 0; i < draggables.length; i++) {
    //   draggables[i].addEventListener("dragstart", dragStart, false);
    //   draggables[i].addEventListener("drag", drag, false);
    //   draggables[i].addEventListener("dragend", dragEnd, false);
    // }
    
//***************************
    //Drag and drop Test 2 #20230622 15:15
    document.addEventListener("DOMContentLoaded", function() {
  const draggables = document.querySelectorAll(".draggable");
  const dragDropSections = document.querySelectorAll("#drag-drop-section");
  let draggedElement;

  draggables.forEach(function(draggableElement) {
    draggableElement.addEventListener("dragstart", function(event) {
      event.dataTransfer.setData("text/plain", draggableElement.id);
      draggedElement = draggableElement;
      setTimeout(function() {
        draggableElement.style.opacity = "0.5";
      }, 0);
    });

    draggableElement.addEventListener("dragend", function() {
      draggableElement.style.opacity = "1";
    });
  });

  dragDropSections.forEach(function(dragDropSection) {
    dragDropSection.addEventListener("dragover", function(event) {
      event.preventDefault();
    });

    dragDropSection.addEventListener("drop", function(event) {
      event.preventDefault();
      const droppedElementId = event.dataTransfer.getData("text/plain");
      const droppedElement = document.getElementById(droppedElementId);
      dragDropSection.appendChild(droppedElement);
    });
  });
});


// 팝업 관련 내용(현재 팝업 기능만 나오게 해놨고, 상황에 따른 것은 TEST필요 #20230622 15:28)
// span 요소를 클릭했을 때 실행되는 함수
    // function showPopup() {
    //   // 팝업 창 표시
    //   var popup = document.getElementById("popup");
    //   popup.style.display = "block";
    // }

    // function memberPopup() {
    //   // 팝업 창 표시
    //   var popup = document.getElementById("popup");
    //   var paragraph = popup.querySelector("p");
    //   paragraph.innerText = target.innerText;
    //   popup.style.display = "block";
    // }

    // // 닫기 버튼을 클릭했을 때 실행되는 함수
    // function closePopup() {
    //   // 팝업 창 숨김
    //   var popup = document.getElementById("popup");
    //   popup.style.display = "none";
    // }

    // // span 요소에 클릭 이벤트 리스너 추가
    // var clickSpan = document.getElementsByClassName("clickSpan");
    // clickSpan.addEventListener("click", memberPopup);

    // // 닫기 버튼에 클릭 이벤트 리스너 추가
    // var closeBtn = document.getElementById("closeBtn");
    // closeBtn.addEventListener("click", closePopup);

function memberPopup(event) {
  // 클릭된 요소의 내용을 가져옴
  var target = event.target;
  var name = target.previousElementSibling.innerText;
  var title = target.innerText;

  // 팝업 창 표시
  var popup = document.getElementById("popup");
  var popupName = popup.querySelector(".popupName");
  var popupTitle = popup.querySelector(".popupTitle");

  popupName.innerText = name;
  popupTitle.innerText = title;
  popup.style.display = "block";
}

// 닫기 버튼을 클릭했을 때 실행되는 함수
function closePopup() {
  // 팝업 창 숨김
  var popup = document.getElementById("popup");
  popup.style.display = "none";
}

// 각 clickSpan 요소에 클릭 이벤트 리스너 추가
var clickSpans = document.getElementsByClassName("clickSpan");
for (var i = 0; i < clickSpans.length; i++) {
  clickSpans[i].addEventListener("click", memberPopup);
}

// 닫기 버튼에 클릭 이벤트 리스너 추가
var closeBtn = document.getElementById("closeBtn");
closeBtn.addEventListener("click", closePopup);
  
</script>

{% endblock %}